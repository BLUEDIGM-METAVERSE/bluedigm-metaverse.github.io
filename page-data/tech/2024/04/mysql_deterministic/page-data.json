{"componentChunkName":"component---src-components-common-post-detail-tsx","path":"/tech/2024/04/mysql_deterministic/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h3>DETERMINISTIC 과 NOT DETERMINISTIC 이란?</h3>\n<p>Real MySQL 8.0 2권 p344~ 부터 DETERMINISTIC 과 NOT DETERMINISTIC 의 일부 내용을 발췌 해보면…</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">DETERMINISTIC이란 \"스토어드 프로그램의 입력이 같다면 시점이나 상황에 관계없이 결과가 항상 같다(확정적이다)\"를 의미하는 키워드다.\r\n\r\n반대로 NOT DETERMINISTIC이란 입력이 같아도 시점에 따라 결과가 달라질 수도 있음을 의미한다.\r\n\r\n일반적으로 일회성으로 실행되는 스토어드 프로시저는 이 옵션의 영향을 거의 받지 않는다.(why?~)\r\n하지만 SQL 문장에서 반복적으로 호출될 수 있는 스토어드 함수는 영향을 많이 받으며, (조금 why?~)\r\n쿼리의 성능을 급격하게 떨어뜨리기도 한다.(why?~)\r\n\r\n...결국 NOT DETERMINISTIC으로 정의된 스토어드 함수는 절대 상수가 될 수 없다.\r\n\r\n더 중요한 점은 이렇게 풀 테이블 스캔을 유도하는 NOT DETERMINISTIC 옵션이 스토어드 함수의 디폴트 옵션이라는 것이다.</code></pre></div>\n<h3>테스트를 해보자!</h3>\n<p>멱등성을 이야기 하는 줄 알았는데… 상수가 될 수 없어도 함수의 리턴값은 상수인데 왜 인덱스가 타지 않을 수 있지? 테스트로 확인 해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">CREATE FUNCTION `sf_getdate_deter`() RETURNS datetime\r\n    DETERMINISTIC\r\nBEGIN\r\n    RETURN now();\r\nEND\r\n\r\nexplain\r\nselect *\r\nfrom table\r\nwhere login_datetime > sf_getdate_deter();\r\n</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e8ea184dfce058de2bb6ae82182b05f3/c37c4/deter.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 9.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAcElEQVR42jWK2Q6DIBQF/f+vbEsrGgRMWGQzUyDxJudh7szyeb8QQuB8wBrL9yeRu0KpA2NOfP9fVyKE2NmyrnI6a0+0NhhtObRm23ac8yw5Z2qttPumlMLDtbbJrTXGDZ9yIsY4m7HhxnLvQgyz/wM4kZoJoho8BgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e8ea184dfce058de2bb6ae82182b05f3/a59e9/deter.webp 192w,\n/static/e8ea184dfce058de2bb6ae82182b05f3/0ca9f/deter.webp 384w,\n/static/e8ea184dfce058de2bb6ae82182b05f3/dc9b9/deter.webp 768w,\n/static/e8ea184dfce058de2bb6ae82182b05f3/9186d/deter.webp 1097w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e8ea184dfce058de2bb6ae82182b05f3/3b721/deter.png 192w,\n/static/e8ea184dfce058de2bb6ae82182b05f3/66595/deter.png 384w,\n/static/e8ea184dfce058de2bb6ae82182b05f3/fe486/deter.png 768w,\n/static/e8ea184dfce058de2bb6ae82182b05f3/c37c4/deter.png 1097w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e8ea184dfce058de2bb6ae82182b05f3/fe486/deter.png\"\n            alt=\"plan image\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">CREATE FUNCTION `sf_getdate_deter_not`() RETURNS datetime\r\n    NOT DETERMINISTIC\r\nBEGIN\r\n    RETURN now();\r\nEND\r\n\r\nexplain\r\nselect *\r\nfrom table\r\nwhere login_datetime > sf_getdate_deter_not();\r\n</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0a2789561d0cfaf8fb6488d11c00a7c1/c6e8f/not_deter.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.416666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAcUlEQVR42jWLQQ7DIAwE8/8/Vo3SHAoGEhqKsAFtDVUOI+2s14tzAa9tw/p8gMjhCOr7jrchGGPh1WOMygfnGXVDsJbgnVcCQjhm59RT+mJJKYGZUUpBrXVmFkZrDSKC3juE/z7uOee5GX8j31zqUgU/+y6ZSB5hRmsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0a2789561d0cfaf8fb6488d11c00a7c1/a59e9/not_deter.webp 192w,\n/static/0a2789561d0cfaf8fb6488d11c00a7c1/0ca9f/not_deter.webp 384w,\n/static/0a2789561d0cfaf8fb6488d11c00a7c1/dc9b9/not_deter.webp 768w,\n/static/0a2789561d0cfaf8fb6488d11c00a7c1/788b5/not_deter.webp 1109w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0a2789561d0cfaf8fb6488d11c00a7c1/3b721/not_deter.png 192w,\n/static/0a2789561d0cfaf8fb6488d11c00a7c1/66595/not_deter.png 384w,\n/static/0a2789561d0cfaf8fb6488d11c00a7c1/fe486/not_deter.png 768w,\n/static/0a2789561d0cfaf8fb6488d11c00a7c1/c6e8f/not_deter.png 1109w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0a2789561d0cfaf8fb6488d11c00a7c1/fe486/not_deter.png\"\n            alt=\"plan image\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3>생각 좀 해보자!</h3>\n<p>NOT DETERMINISTIC 으로 하면 리턴 값이 일정하다 안하다의 멱등성 이야기라기 보다 sf_getdate_deter_not() 결과값을 상수값으로 취급을 안한다? 위와 같이 동작한다면 경우에 따라 성능이…으아아…</p>\n<p>스칼라 서브쿼리에서 쓰이는 경우는 어떻게 되는걸까? 스칼라 서브쿼리는 캐싱되서 재활용 되는 것으로 알았는데 그보다 함수의 상수화 방향인건가? 이건 좀 추후 다시 알아봐야겠다.</p>\n<h3>결론</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">일단 DETERMINISTIC 옵션을 주어서 함수를 만드는게 좋겠다.\r\n무조건은 아니지만...\r\n근데 왜 MySQL 에서 NOT DETERMINISTIC 옵션이 기본값인거지?</code></pre></div>","frontmatter":{"category":"Tech","title":"MySQL 스토어드 프로시저 리턴값이 상수값이 아닐 수 있다고???","date":"2024-04-16","writer":"최일주","tags":["DETERMINISTIC","MySQL"]}}}]}},"pageContext":{"slug":"/tech/2024/04/mysql_deterministic/"}},"staticQueryHashes":["2815043651","2871081380","2984666484","3268533384","4124519152","496201424"],"slicesMap":{}}